FAIL src/tests/controllers/photosController.test.ts
  PhotosController
    deletePhoto
      ‚àö should delete photo successfully (Storage + DB + Audit) (4 ms)
      √ó should throw 400 if ID is missing (1 ms)
      √ó should throw 404 if photo not found
      √ó should throw 401 if user not authenticated
      √ó should throw 403 if user is not ADMIN
      ‚àö should update form data if photo was present in form (1 ms)
    deletePhotoByUrl
      ‚àö should delete by URL query param
      ‚àö should delete by body url param
      √ó should throw 400 if url missing (1 ms)

  ‚óè PhotosController ‚Ä∫ deletePhoto ‚Ä∫ should throw 400 if ID is missing

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

    [0m [90m 103 |[39m       req[33m.[39mparams[33m.[39mid [33m=[39m [32m""[39m[33m;[39m
     [90m 104 |[39m
    [31m[1m>[22m[39m[90m 105 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 106 |[39m         deletePhoto(req [36mas[39m [33mRequest[39m[33m,[39m res [36mas[39m [33mResponse[39m[33m,[39m () [33m=>[39m {})
     [90m 107 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m"ID da foto √© obrigat√≥rio"[39m)[33m;[39m
     [90m 108 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/tests/controllers/photosController.test.ts:105:13)

  ‚óè PhotosController ‚Ä∫ deletePhoto ‚Ä∫ should throw 404 if photo not found

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

    [0m [90m 112 |[39m       (prisma[33m.[39mphoto[33m.[39mfindUnique [36mas[39m jest[33m.[39m[33mMock[39m)[33m.[39mmockResolvedValue([36mnull[39m)[33m;[39m
     [90m 113 |[39m
    [31m[1m>[22m[39m[90m 114 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 115 |[39m         deletePhoto(req [36mas[39m [33mRequest[39m[33m,[39m res [36mas[39m [33mResponse[39m[33m,[39m () [33m=>[39m {})
     [90m 116 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m"Foto n√£o encontrada"[39m)[33m;[39m
     [90m 117 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/tests/controllers/photosController.test.ts:114:13)

  ‚óè PhotosController ‚Ä∫ deletePhoto ‚Ä∫ should throw 401 if user not authenticated

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

    [0m [90m 122 |[39m       req[33m.[39muser [33m=[39m undefined[33m;[39m
     [90m 123 |[39m
    [31m[1m>[22m[39m[90m 124 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 125 |[39m         deletePhoto(req [36mas[39m [33mRequest[39m[33m,[39m res [36mas[39m [33mResponse[39m[33m,[39m () [33m=>[39m {})
     [90m 126 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m"N√£o autenticado"[39m)[33m;[39m
     [90m 127 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/tests/controllers/photosController.test.ts:124:13)

  ‚óè PhotosController ‚Ä∫ deletePhoto ‚Ä∫ should throw 403 if user is not ADMIN

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

    [0m [90m 132 |[39m       req[33m.[39muser [33m=[39m { userId[33m:[39m [32m"u-2"[39m[33m,[39m role[33m:[39m [32m"MANAGER"[39m }[33m;[39m
     [90m 133 |[39m
    [31m[1m>[22m[39m[90m 134 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 135 |[39m         deletePhoto(req [36mas[39m [33mRequest[39m[33m,[39m res [36mas[39m [33mResponse[39m[33m,[39m () [33m=>[39m {})
     [90m 136 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m"Apenas administradores podem deletar fotos"[39m)[33m;[39m
     [90m 137 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/tests/controllers/photosController.test.ts:134:13)

  ‚óè PhotosController ‚Ä∫ deletePhotoByUrl ‚Ä∫ should throw 400 if url missing

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

    [0m [90m 205 |[39m       req[33m.[39mbody [33m=[39m {}[33m;[39m
     [90m 206 |[39m
    [31m[1m>[22m[39m[90m 207 |[39m       [36mawait[39m expect(
     [90m     |[39m             [31m[1m^[22m[39m
     [90m 208 |[39m         deletePhotoByUrl(req [36mas[39m [33mRequest[39m[33m,[39m res [36mas[39m [33mResponse[39m[33m,[39m () [33m=>[39m {})
     [90m 209 |[39m       )[33m.[39mrejects[33m.[39mtoThrow([32m"Par√¢metro url √© obrigat√≥rio"[39m)[33m;[39m
     [90m 210 |[39m     })[33m;[39m[0m

      at expect (node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/tests/controllers/photosController.test.ts:207:13)

----------------------|---------|----------|---------|---------|-------------------
File                  | % Stmts | % Branch | % Funcs | % Lines | Uncovered Line #s 
----------------------|---------|----------|---------|---------|-------------------
All files             |   73.33 |    65.78 |      75 |   72.54 |                   
 controllers          |   92.42 |       96 |     100 |   92.42 |                   
  photosController.ts |   92.42 |       96 |     100 |   92.42 | 44,81,118,130-131 
 middleware           |   41.02 |     7.69 |      50 |   36.11 |                   
  errorHandler.ts     |   41.02 |     7.69 |      50 |   36.11 | 34-102,115        
----------------------|---------|----------|---------|---------|-------------------
Test Suites: 1 failed, 1 total
Tests:       5 failed, 4 passed, 9 total
Snapshots:   0 total
Time:        2.519 s, estimated 4 s
Ran all test suites matching /src\\tests\\controllers\\photosController.test.ts/i.
Force exiting Jest: Have you considered using `--detectOpenHandles` to detect async operations that kept running after all tests finished?
